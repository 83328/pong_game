{
    # We disable auto HTTPS because we're using our own certificate.
    auto_https off
}

# Redirect all HTTP requests to HTTPS
http://* {
    redir https://{host}{uri} permanent
}

# Handle HTTPS requests with TLS using your self-signed certificates
https://* {
    tls /etc/caddy/certs/localhost.pem /etc/caddy/certs/localhost-key.pem

    # Set the root for static assets
    root * /usr/share/caddy/html

    ## Forward API requests to the backend container
    handle /api/* {
         reverse_proxy backend:8000
    }

    ## Forward WebSocket requests (e.g., for the game) to the backend container
    handle /ws/* {
         reverse_proxy backend:8001
    }

    ## Forward Media requests (e.g., file uploads) to the backend container
    handle /media/* {
         reverse_proxy backend:8000
    }

    ## All other requests: try to serve the requested file,
    ## otherwise fallback to index.html (for Single Page Applications)
    handle {
         try_files {path} /index.html
         file_server
    }
}
